<% if user_signed_in? %>
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
      <%= link_to root_path, class: "navbar-brand" do %>
        <%= image_tag "logo.png", height: 40 %>
      <% end %>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarContent">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <%= link_to calculate_quotes_path, class: "nav-link" do %>
              <i class="fas fa-calculator me-1"></i> Nueva Cotización
            <% end %>
          </li>
          
          <li class="nav-item">
            <%= link_to root_path, class: "nav-link" do %>
              <i class="fas fa-list me-1"></i> Cotizaciones
            <% end %>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
              <i class="fas fa-cog me-1"></i> Configuración
            </a>
            <div class="dropdown-menu dropdown-menu-end">
              <%= link_to edit_api_key_path, class: "dropdown-item" do %>
                <i class="fas fa-key me-2"></i> API Key Pipedrive
              <% end %>
              
              <%= link_to general_configurations_path, class: "dropdown-item" do %>
                <i class="fas fa-sliders-h me-2"></i> Configuración General
              <% end %>
              
              <%= link_to materials_path, class: "dropdown-item" do %>
                <i class="fas fa-box me-2"></i> Materiales
              <% end %>
              
              <%= link_to manufacturing_processes_path, class: "dropdown-item" do %>
                <i class="fas fa-industry me-2"></i> Procesos
              <% end %>
              
              <%= link_to extras_path, class: "dropdown-item" do %>
                <i class="fas fa-plus-circle me-2"></i> Extras
              <% end %>
              
              <%= link_to units_path, class: "dropdown-item" do %>
                <i class="fas fa-ruler me-2"></i> Unidades
              <% end %>
            </div>
          </li>

          <li class="nav-item">
            <%= button_to destroy_user_session_path, method: :delete, class: "nav-link border-0 bg-transparent" do %>
              <i class="fas fa-sign-out-alt me-1"></i> Cerrar Sesión
            <% end %>
          </li>
        </ul>
      </div>
    </div>
  </nav>
<% else %>
  <nav class="navbar navbar-expand-lg navbar-light">
    <a class="navbar-brand" href="<%= root_path %>"> 
      <%= image_tag("logo.png", alt: "Surtibox Logo", width: 250) %> 
    </a>
    
    <button class="navbar-toggler" 
            type="button" 
            data-toggle="collapse" 
            data-target="#navbarNav" 
            aria-controls="navbarNav" 
            aria-expanded="false" 
            aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <%= link_to 'Cotizar', calculate_quotes_path, class: "nav-link" %> 
        </li>
        <li class="nav-item divider"></li>
        <li class="nav-item dropdown"> 
          <a class="nav-link dropdown-toggle" 
             href="#" 
             id="navbarDropdown" 
             role="button" 
             data-toggle="dropdown" 
             aria-haspopup="true" 
             aria-expanded="false">
            Catálogos 
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown"> 
            <%= link_to 'Materiales', materials_path, class: "dropdown-item", data: { turbo_frame: "main-content" } %>
            <%= link_to 'Procesos', manufacturing_processes_path, class: "dropdown-item", data: { turbo_frame: "main-content" } %>
            <%= link_to 'Herramental', toolings_path, class: "dropdown-item", data: { turbo_frame: "main-content" } %>
            <div class="dropdown-divider"></div>
            <%= link_to 'Unidades de medida', units_path, class: "dropdown-item", data: { turbo_frame: "main-content" } %>
            <%= link_to 'Configuraciones generales', general_configurations_path, class: "dropdown-item", data: { turbo_frame: "main-content" } %>
            <%= link_to 'Equivalencias', unit_equivalences_path_path, class: "dropdown-item", data: { turbo_frame: "main-content" } %>
          </div>
        </li>
        <li class="nav-item divider"></li> 
        <li class="nav-item dropdown"> 
          <a class="nav-link dropdown-toggle" 
             href="#" 
             id="userDropdown" 
             role="button" 
             data-toggle="dropdown" 
             aria-haspopup="true" 
             aria-expanded="false">
            <%= current_user.email %> 
          </a>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown"> 
            <%= link_to 'Edit profile', edit_user_registration_path, class: "dropdown-item" %>
            <%= button_to 'Logout', destroy_user_session_path, method: :delete, class: "dropdown-item" %>
          </div>
        </li>
      </ul>
    </div>
  </nav>
<% end %>

<%# Add Bootstrap JavaScript dependencies %>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script> 